<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title>pksunkara - reign</title>
	<subtitle>My personal blog</subtitle>
	<link href="https://pksunkara.com/tags/reign/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://pksunkara.com"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2020-03-27T00:00:00+01:00</updated>
	<id>https://pksunkara.com/tags/reign/atom.xml</id>
	<entry xml:lang="en">
		<title>Reign: Configuration Management - II</title>
		<published>2020-03-27T00:00:00+01:00</published>
		<updated>2020-03-27T00:00:00+01:00</updated>
		<link href="https://pksunkara.com/posts/reign-configuration-management-ii/" type="text/html"/>
		<id>https://pksunkara.com/posts/reign-configuration-management-ii/</id>
		<content type="html">&lt;p&gt;We have looked at the basic requirements for a configuration management system in our &lt;a href=&quot;..&#x2F;reign-configuration-management&quot;&gt;previous post&lt;&#x2F;a&gt;. If you recall, we described one of the requirement as:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Retrieving a configuration value from the system should be as simple as writing a variable name&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Reading an environment variable is especially tricky because they do not have types. A variable whose value is &lt;code&gt;&amp;quot;true&amp;quot;&lt;&#x2F;code&gt; can be describing either a &lt;code&gt;String&lt;&#x2F;code&gt; or a &lt;code&gt;bool&lt;&#x2F;code&gt;. Similarly, a variable with value &lt;code&gt;&amp;quot;1&amp;quot;&lt;&#x2F;code&gt; can be describing any of &lt;code&gt;String&lt;&#x2F;code&gt;, &lt;code&gt;int32&lt;&#x2F;code&gt; or &lt;code&gt;bool&lt;&#x2F;code&gt;. If we implement a naive retrieval system, then the user would need to validate the value before using it.&lt;&#x2F;p&gt;
&lt;p&gt;We also describe another requirement as:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Merge env vars with config in files&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;One of the issues with this approach is leaking of non application related environment variables into the application code. While doing this in a backend application might not be a big security issue, it would still be better if the configuration management system can allow the users to whitelist all the config values they need.&lt;&#x2F;p&gt;
&lt;p&gt;We haven&#x27;t really talked about using secrets in configuration variables during development of the application. You can not write them into the config files because they are secret and need to be kept that way. A developer can always create local environment variables before starting development but this becomes cumbersome and repetitive. One way of fixing this would be to store those environment variables in the developer&#x27;s local shell profile. But, what if two different applications use the same environment vairable name?&lt;&#x2F;p&gt;
&lt;p&gt;We can solve this by using &lt;strong&gt;local config files&lt;&#x2F;strong&gt;. These files are similar to the environment config files but are not stored in the code and exist only locally. Our configuration management system needs to account for these files while processing the config files.&lt;&#x2F;p&gt;
&lt;p&gt;Let us think of a medium sized team of five developers working on an application. They would need to share the secrets with each other for local development. They could pass around these &lt;strong&gt;local config files&lt;&#x2F;strong&gt;, but this is not scalable. They could give people access to the secrets so that the developers can retrieve the secrets directly, but this is also not scalable and more importantly not secure from an organisation perspective.&lt;&#x2F;p&gt;
&lt;p&gt;We can fix this by having an external secret manager (ex: &lt;a href=&quot;https:&#x2F;&#x2F;www.vaultproject.io&#x2F;&quot;&gt;Vault&lt;&#x2F;a&gt;) and a small script which can retrieve the secrets after retrieving code from upstream. Applications with secrets for local development is a rare use case and our system can either support this or not. It can also be argued that this is out of scope for the configuration management system.&lt;&#x2F;p&gt;
&lt;p&gt;Thus, a good configuration manager should also:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Validate the config value during retrieval&lt;&#x2F;li&gt;
&lt;li&gt;Allow whitelisting of needed environment variables&lt;&#x2F;li&gt;
&lt;li&gt;Support local config files&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Reign: Configuration Management</title>
		<published>2019-12-13T00:00:00+05:30</published>
		<updated>2019-12-13T00:00:00+05:30</updated>
		<link href="https://pksunkara.com/posts/reign-configuration-management/" type="text/html"/>
		<id>https://pksunkara.com/posts/reign-configuration-management/</id>
		<content type="html">&lt;p&gt;Every web application requires configuration management. Providing a configuration manager is one of important tasks of any web framework.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rubyonrails.org&quot;&gt;Rails&lt;&#x2F;a&gt; does it by asking the user to edit yaml files and a few ruby files. Some node.js frameworks achieve this by using JSON files. In this post, I will present an idea on how the configuration management system should ideally work.&lt;&#x2F;p&gt;
&lt;p&gt;Few years ago, &lt;a href=&quot;https:&#x2F;&#x2F;heroku.com&quot;&gt;Heroku&lt;&#x2F;a&gt; published a website detailing a concept called &lt;a href=&quot;http:&#x2F;&#x2F;12factor.net&quot;&gt;The Twelve-Factor App&lt;&#x2F;a&gt;. We can see that configuration is listed third in the list. I would like to quote some of their sentences.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;An application’s config is everything that is likely to vary between deploys (staging, production, developer environments, etc)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Being run in different environments is something that a web application cannot avoid. A normal web application would need at least 3 different environments. One for &lt;strong&gt;production&lt;&#x2F;strong&gt;, one for &lt;strong&gt;development&lt;&#x2F;strong&gt; and the last for &lt;strong&gt;test&lt;&#x2F;strong&gt;. A good configuration system should support multiple environments.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Apps sometimes store config as constants in the code. This is a violation of twelve-factor, which requires strict separation of config from code.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;This is the driving force behind using a configuration management system. Some might say that this would complicate the overall code by adding yet another module. It would also take more time to develop this system. But, with the rise of module&#x2F;package managers, it is just a matter of plugging in the system. In order to reduce further complexity, Retrieving a configuration value from the system should be as simple as writing a variable name.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;The twelve-factor app stores config in environment variables&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Most of the current configuration managers use files to store the config. This method still doesn’t solve the problem of needing to add the config files to the code. As mentioned above, the ideal method of storing config is using environment variables (also known as &lt;strong&gt;env vars&lt;&#x2F;strong&gt; or &lt;strong&gt;env&lt;&#x2F;strong&gt;). On average, a web application needs at least 10 config variables. It will be difficult and annoying for the developer to use and maintain such high number of env vars which is why most of them opt to add the config files to their code.&lt;&#x2F;p&gt;
&lt;p&gt;Therefore, an ideal configuration system should support both env vars and config files. It would be even better if the system could merge the env vars with the config files. Maybe it can support command line arguments too.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;In a twelve-factor app, env vars are granular controls, each fully orthogonal to other env vars. They are never grouped together as “environments”, but instead are independently managed for each deploy.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Most people don’t realize that there is a hidden problem in this. For example, if a developer wants to use database information config from &lt;strong&gt;staging&lt;&#x2F;strong&gt; environment for their personal &lt;strong&gt;joes-staging&lt;&#x2F;strong&gt; environment, they need to keep monitoring the &lt;strong&gt;staging&lt;&#x2F;strong&gt; environment for any changes and have to update their personal environment config file. One way to mitigate this issue is by providing a way for environment config files to merge with each other while allowing to batch config in named groups.&lt;&#x2F;p&gt;
&lt;p&gt;Then, in the above example, all Joe has to do is create a &lt;strong&gt;joes.staging&lt;&#x2F;strong&gt; environment config file with the required config and leave the database config empty. When the configuration manager needs to retrieve database config for his environment, it should fallback to &lt;strong&gt;staging&lt;&#x2F;strong&gt; environment config.&lt;&#x2F;p&gt;
&lt;p&gt;Let us recap. A good configuration manager should:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Support multiple environments in files&lt;&#x2F;li&gt;
&lt;li&gt;Be easy to retrieve a config value&lt;&#x2F;li&gt;
&lt;li&gt;Merge env vars, command line args with config in files&lt;&#x2F;li&gt;
&lt;li&gt;Merge different environment files when required&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
</feed>
